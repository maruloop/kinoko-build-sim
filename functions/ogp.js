var r,f=new Array(128).fill(void 0);f.push(void 0,null,!0,!1);var h=f.length;function g(t){h===f.length&&f.push(f.length+1);let e=h;return h=f[e],f[e]=t,e}function a(t){return f[t]}function I(t){t<132||(f[t]=h,h=t)}function d(t){let e=a(t);return I(t),e}var p=0,u=null;function y(){return(u===null||u.byteLength===0)&&(u=new Uint8Array(r.memory.buffer)),u}var v=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},j=typeof v.encodeInto=="function"?function(t,e){return v.encodeInto(t,e)}:function(t,e){let n=v.encode(t);return e.set(n),{read:t.length,written:n.length}};function B(t,e,n){if(n===void 0){let c=v.encode(t),w=e(c.length,1)>>>0;return y().subarray(w,w+c.length).set(c),p=c.length,w}let _=t.length,i=e(_,1)>>>0,b=y(),o=0;for(;o<_;o++){let c=t.charCodeAt(o);if(c>127)break;b[i+o]=c}if(o!==_){o!==0&&(t=t.slice(o)),i=n(i,_,_=o+t.length*3,1)>>>0;let c=y().subarray(i+o,i+_),w=j(t,c);o+=w.written,i=n(i,_,o,1)>>>0}return p=o,i}function R(t){return t==null}var l=null;function s(){return(l===null||l.byteLength===0)&&(l=new Int32Array(r.memory.buffer)),l}var O=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&O.decode();function m(t,e){return t=t>>>0,O.decode(y().subarray(t,t+e))}function M(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`);return t.ptr}function U(t,e){try{return t.apply(this,e)}catch(n){r.__wbindgen_exn_store(g(n))}}var T=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_bbox_free(t>>>0)),x=class z{static __wrap(e){e=e>>>0;let n=Object.create(z.prototype);return n.__wbg_ptr=e,T.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,T.unregister(this),e}free(){let e=this.__destroy_into_raw();r.__wbg_bbox_free(e)}get x(){return r.__wbg_get_bbox_x(this.__wbg_ptr)}set x(e){r.__wbg_set_bbox_x(this.__wbg_ptr,e)}get y(){return r.__wbg_get_bbox_y(this.__wbg_ptr)}set y(e){r.__wbg_set_bbox_y(this.__wbg_ptr,e)}get width(){return r.__wbg_get_bbox_width(this.__wbg_ptr)}set width(e){r.__wbg_set_bbox_width(this.__wbg_ptr,e)}get height(){return r.__wbg_get_bbox_height(this.__wbg_ptr)}set height(e){r.__wbg_set_bbox_height(this.__wbg_ptr,e)}},W=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_renderedimage_free(t>>>0)),C=class k{static __wrap(e){e=e>>>0;let n=Object.create(k.prototype);return n.__wbg_ptr=e,W.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,W.unregister(this),e}free(){let e=this.__destroy_into_raw();r.__wbg_renderedimage_free(e)}get width(){return r.renderedimage_width(this.__wbg_ptr)>>>0}get height(){return r.renderedimage_height(this.__wbg_ptr)>>>0}asPng(){try{let i=r.__wbindgen_add_to_stack_pointer(-16);r.renderedimage_asPng(i,this.__wbg_ptr);var e=s()[i/4+0],n=s()[i/4+1],_=s()[i/4+2];if(_)throw d(n);return d(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}get pixels(){let e=r.renderedimage_pixels(this.__wbg_ptr);return d(e)}},L=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_resvg_free(t>>>0)),P=class{__destroy_into_raw(){let t=this.__wbg_ptr;return this.__wbg_ptr=0,L.unregister(this),t}free(){let t=this.__destroy_into_raw();r.__wbg_resvg_free(t)}constructor(t,e,n){try{let w=r.__wbindgen_add_to_stack_pointer(-16);var _=R(e)?0:B(e,r.__wbindgen_malloc,r.__wbindgen_realloc),i=p;r.resvg_new(w,g(t),_,i,R(n)?0:g(n));var b=s()[w/4+0],o=s()[w/4+1],c=s()[w/4+2];if(c)throw d(o);return this.__wbg_ptr=b>>>0,this}finally{r.__wbindgen_add_to_stack_pointer(16)}}get width(){return r.resvg_width(this.__wbg_ptr)}get height(){return r.resvg_height(this.__wbg_ptr)}render(){try{let _=r.__wbindgen_add_to_stack_pointer(-16);r.resvg_render(_,this.__wbg_ptr);var t=s()[_/4+0],e=s()[_/4+1],n=s()[_/4+2];if(n)throw d(e);return C.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}toString(){let t,e;try{let i=r.__wbindgen_add_to_stack_pointer(-16);r.resvg_toString(i,this.__wbg_ptr);var n=s()[i/4+0],_=s()[i/4+1];return t=n,e=_,m(n,_)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e,1)}}innerBBox(){let t=r.resvg_innerBBox(this.__wbg_ptr);return t===0?void 0:x.__wrap(t)}getBBox(){let t=r.resvg_getBBox(this.__wbg_ptr);return t===0?void 0:x.__wrap(t)}cropByBBox(t){M(t,x),r.resvg_cropByBBox(this.__wbg_ptr,t.__wbg_ptr)}imagesToResolve(){try{let _=r.__wbindgen_add_to_stack_pointer(-16);r.resvg_imagesToResolve(_,this.__wbg_ptr);var t=s()[_/4+0],e=s()[_/4+1],n=s()[_/4+2];if(n)throw d(e);return d(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}resolveImage(t,e){try{let i=r.__wbindgen_add_to_stack_pointer(-16),b=B(t,r.__wbindgen_malloc,r.__wbindgen_realloc),o=p;r.resvg_resolveImage(i,this.__wbg_ptr,b,o,g(e));var n=s()[i/4+0],_=s()[i/4+1];if(_)throw d(n)}finally{r.__wbindgen_add_to_stack_pointer(16)}}};async function D(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(_){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}let n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{let n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function q(){let t={};return t.wbg={},t.wbg.__wbg_new_28c511d9baebfa89=function(e,n){let _=new Error(m(e,n));return g(_)},t.wbg.__wbindgen_memory=function(){let e=r.memory;return g(e)},t.wbg.__wbg_buffer_12d079cc21e14bdb=function(e){let n=a(e).buffer;return g(n)},t.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(e,n,_){let i=new Uint8Array(a(e),n>>>0,_>>>0);return g(i)},t.wbg.__wbindgen_object_drop_ref=function(e){d(e)},t.wbg.__wbg_new_63b92bc8671ed464=function(e){let n=new Uint8Array(a(e));return g(n)},t.wbg.__wbg_values_839f3396d5aac002=function(e){let n=a(e).values();return g(n)},t.wbg.__wbg_next_196c84450b364254=function(){return U(function(e){let n=a(e).next();return g(n)},arguments)},t.wbg.__wbg_done_298b57d23c0fc80c=function(e){return a(e).done},t.wbg.__wbg_value_d93c65011f51a456=function(e){let n=a(e).value;return g(n)},t.wbg.__wbg_instanceof_Uint8Array_2b3bbecd033d19f6=function(e){let n;try{n=a(e)instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbindgen_string_get=function(e,n){let _=a(n),i=typeof _=="string"?_:void 0;var b=R(i)?0:B(i,r.__wbindgen_malloc,r.__wbindgen_realloc),o=p;s()[e/4+1]=o,s()[e/4+0]=b},t.wbg.__wbg_new_16b304a2cfa7ff4a=function(){let e=new Array;return g(e)},t.wbg.__wbindgen_string_new=function(e,n){let _=m(e,n);return g(_)},t.wbg.__wbg_push_a5b05aedc7234f9f=function(e,n){return a(e).push(a(n))},t.wbg.__wbg_length_c20a40f15020d68a=function(e){return a(e).length},t.wbg.__wbg_set_a47bac70306a19a7=function(e,n,_){a(e).set(a(n),_>>>0)},t.wbg.__wbindgen_throw=function(e,n){throw new Error(m(e,n))},t}function N(t,e){return r=t.exports,E.__wbindgen_wasm_module=e,l=null,u=null,r}async function E(t){if(r!==void 0)return r;typeof t>"u"&&(t=new URL("index_bg.wasm",void 0));let e=q();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));let{instance:n,module:_}=await D(await t,e);return N(n,_)}var G=E,A=!1,S=async t=>{if(A)throw new Error("Already initialized. The `initWasm()` function can be used only once.");await G(await t),A=!0},F=class extends P{constructor(t,e){if(!A)throw new Error("Wasm has not been initialized. Call `initWasm()` function.");let n=e?.font;if(n&&V(n)){let _={...e,font:{...n,fontBuffers:void 0}};super(t,JSON.stringify(_),n.fontBuffers)}else super(t,JSON.stringify(e))}};function V(t){return Object.prototype.hasOwnProperty.call(t,"fontBuffers")}var Z=async t=>{let{request:e,env:n}=t,_=new URL(e.url),i=J(_.searchParams.get("title")||"\u30AD\u30CE\u30B3\u4F1D\u8AAC\u30D3\u30EB\u30C9\u30B7\u30DF\u30E5\u30EC\u30FC\u30BF\u30FC"),b=await n.OGP_WASM.get("index_bg.wasm","arrayBuffer");if(!b)return new Response("Wasm not found in KV",{status:404});await S(b);let w=new F(H(i)).render().asPng();return new Response(w,{headers:{"Content-Type":"image/png","Cache-Control":"public, max-age=86400"}})};function H(t){return`
    <svg width="1200" height="630" xmlns="http://www.w3.org/2000/svg">
      <rect width="100%" height="100%" fill="#f9f9f9"/>
      <text x="50%" y="50%" font-family="Arial" font-size="64" fill="#333" text-anchor="middle">${K(t)}</text>
    </svg>`}function J(t){return t.length>25?t.slice(0,25)+"\u2026":t}function K(t){return t.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[e]||e)}export{Z as onRequestGet};
//# sourceMappingURL=ogp.js.map
